# ğŸ¨ DIAGRAMAS VISUALES - Arquitectura Hexagonal

## ğŸ“ Vista General de la Arquitectura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MUNDO EXTERIOR                             â”‚
â”‚  (Usuarios, APIs externas, Bases de datos, Message queues)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸŸ© INFRASTRUCTURE (Adaptadores)                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Adaptadores  â”‚                            â”‚ Adaptadores  â”‚  â”‚
â”‚  â”‚    IN        â”‚                            â”‚    OUT       â”‚  â”‚
â”‚  â”‚              â”‚                            â”‚              â”‚  â”‚
â”‚  â”‚  â€¢ REST      â”‚                            â”‚ â€¢ Database   â”‚  â”‚
â”‚  â”‚  â€¢ GraphQL   â”‚                            â”‚ â€¢ Cache      â”‚  â”‚
â”‚  â”‚  â€¢ gRPC      â”‚                            â”‚ â€¢ Message Q  â”‚  â”‚
â”‚  â”‚  â€¢ Kafka     â”‚                            â”‚ â€¢ APIs       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                             â–²         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                             â”‚
          â–¼                                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸŸ¦ DOMAIN (NÃºcleo de negocio)                       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  Puertos IN  â”‚         â”‚  Puertos OUT â”‚                     â”‚
â”‚  â”‚  (Use Cases) â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚                     â”‚
â”‚  â”‚              â”‚         â”‚              â”‚                     â”‚
â”‚  â”‚ â€¢ Consultar  â”‚         â”‚ â€¢ Repository â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚ â€¢ Crear      â”‚         â”‚ â€¢ Cache      â”‚                     â”‚
â”‚  â”‚ â€¢ Actualizar â”‚         â”‚ â€¢ Messaging  â”‚                     â”‚
â”‚  â”‚ â€¢ Eliminar   â”‚         â”‚              â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚   Modelos    â”‚                                               â”‚
â”‚  â”‚   Dominio    â”‚                                               â”‚
â”‚  â”‚              â”‚                                               â”‚
â”‚  â”‚ â€¢ Saldo      â”‚                                               â”‚
â”‚  â”‚ â€¢ ValidaciÃ³n â”‚                                               â”‚
â”‚  â”‚ â€¢ LÃ³gica     â”‚                                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸŸ¨ APPLICATION (OrquestaciÃ³n)                       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            ImplementaciÃ³n de Casos de Uso                â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  â€¢ Orquesta llamadas a puertos OUT                      â”‚  â”‚
â”‚  â”‚  â€¢ Aplica lÃ³gica de aplicaciÃ³n (no de dominio)         â”‚  â”‚
â”‚  â”‚  â€¢ Transacciones, logging, mÃ©tricas                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de Consulta de Saldo (Detallado)

```
1. Usuario hace peticiÃ³n HTTP
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTTP GET /api/v1/saldos/123456                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŸ© SaldoController (Adaptador IN - REST)                       â”‚
â”‚                                                                  â”‚
â”‚  obtenerSaldo(cuenta: "123456")                                 â”‚
â”‚     â”‚                                                            â”‚
â”‚     â””â”€â–º consultarSaldoUseCase.consultarSaldo("123456")         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŸ¦ ConsultarSaldoUseCase (Puerto IN - Interface)               â”‚
â”‚                                                                  â”‚
â”‚  consultarSaldo(cuenta: String): Mono<Saldo>                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŸ¨ ConsultarSaldoUseCaseImpl (ImplementaciÃ³n)                  â”‚
â”‚                                                                  â”‚
â”‚  1. Intenta obtener de cache                                    â”‚
â”‚     cachePort.obtener("123456")                                 â”‚
â”‚        â”‚                                                         â”‚
â”‚        â””â”€â–º Â¿EstÃ¡ en cache?                                      â”‚
â”‚              â”‚                                                   â”‚
â”‚              â”œâ”€â–º SÃ: Devolver Saldo                            â”‚
â”‚              â”‚                                                   â”‚
â”‚              â””â”€â–º NO: Continuar...                               â”‚
â”‚                                                                  â”‚
â”‚  2. Busca en base de datos                                      â”‚
â”‚     saldoRepository.findByNumeroCuenta("123456")               â”‚
â”‚        â”‚                                                         â”‚
â”‚        â””â”€â–º Â¿Existe en BD?                                       â”‚
â”‚              â”‚                                                   â”‚
â”‚              â”œâ”€â–º SÃ: Guardar en cache y devolver              â”‚
â”‚              â”‚                                                   â”‚
â”‚              â””â”€â–º NO: Lanzar SaldoNoEncontradoException         â”‚
â”‚                                                                  â”‚
â”‚  3. Aplicar resiliencia                                         â”‚
â”‚     â€¢ Timeout (1 seg)                                           â”‚
â”‚     â€¢ Retry (2 intentos)                                        â”‚
â”‚     â€¢ Circuit Breaker                                           â”‚
â”‚     â€¢ Fallback (saldo = 0)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â”œâ”€â–º Cache? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                              â”‚
   â”‚                                              â–¼
   â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                               â”‚  ğŸŸ¦ SaldoCachePort           â”‚
   â”‚                               â”‚  (Puerto OUT - Interface)    â”‚
   â”‚                               â”‚                              â”‚
   â”‚                               â”‚  obtener(String): Mono<Saldo>â”‚
   â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                                              â”‚
   â”‚                                              â–¼
   â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                               â”‚  ğŸŸ© RedisCacheAdapter        â”‚
   â”‚                               â”‚  (Adaptador OUT)             â”‚
   â”‚                               â”‚                              â”‚
   â”‚                               â”‚  ReactiveRedisTemplate       â”‚
   â”‚                               â”‚     .opsForValue()           â”‚
   â”‚                               â”‚     .get("123456")           â”‚
   â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                                              â”‚
   â”‚                                              â–¼
   â”‚                                         [Redis Cache]
   â”‚                                              â”‚
   â”‚                                              â–¼
   â”‚                                      Â¿Encontrado?
   â”‚                                        â”‚      â”‚
   â”‚                                        â”‚      â””â”€â–º NO
   â”‚                                        â”‚
   â”‚                                        â””â”€â–º SÃ: Devolver Saldo
   â”‚                                                   â”‚
   â”‚                                                   â””â”€â”€â”€â”
   â”‚                                                       â”‚
   â””â”€â–º Base de datos? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
                                            â”‚              â”‚
                                            â–¼              â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                         â”‚  ğŸŸ¦ SaldoRepositoryPort      â”‚ â”‚
                         â”‚  (Puerto OUT - Interface)    â”‚ â”‚
                         â”‚                              â”‚ â”‚
                         â”‚  findByNumeroCuenta(String)  â”‚ â”‚
                         â”‚  : Mono<Saldo>               â”‚ â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                            â”‚              â”‚
                                            â–¼              â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                         â”‚  ğŸŸ© SaldoRepositoryAdapter   â”‚ â”‚
                         â”‚  (Adaptador OUT)             â”‚ â”‚
                         â”‚                              â”‚ â”‚
                         â”‚  SaldoR2dbcRepository        â”‚ â”‚
                         â”‚     .findByNumeroCuenta()    â”‚ â”‚
                         â”‚     .map(toDomain())         â”‚ â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                            â”‚              â”‚
                                            â–¼              â”‚
                                     [PostgreSQL]          â”‚
                                            â”‚              â”‚
                                            â–¼              â”‚
                                      SaldoEntity          â”‚
                                            â”‚              â”‚
                                            â–¼              â”‚
                         ConversiÃ³n: Entity â†’ Domain      â”‚
                                            â”‚              â”‚
                                            â–¼              â”‚
                                    Saldo (dominio)       â”‚
                                            â”‚              â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚  Mono<Saldo>     â”‚
                                  â”‚  cuenta: 123456  â”‚
                                  â”‚  monto: 5000.00  â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŸ© SaldoController                                              â”‚
â”‚                                                                  â”‚
â”‚  ConversiÃ³n: Saldo â†’ SaldoResponse (DTO)                       â”‚
â”‚     â”‚                                                            â”‚
â”‚     â””â”€â–º SaldoResponse(cuenta: "123456", monto: 5000.00)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTTP 200 OK                                                     â”‚
â”‚  {                                                               â”‚
â”‚    "numeroCuenta": "123456",                                    â”‚
â”‚    "monto": 5000.00                                             â”‚
â”‚  }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›¡ï¸ Patrones de Resiliencia Aplicados

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PeticiÃ³n entrante                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ğŸŸ¨ Use Case      â”‚
                    â”‚                    â”‚
                    â”‚  Mono.defer(() â†’   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  1ï¸âƒ£ TIMEOUT (1 segundo)              â”‚
           â”‚  .timeout(Duration.ofSeconds(1))     â”‚
           â”‚                                       â”‚
           â”‚  â±ï¸ Si tarda > 1s â†’ TimeoutException â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  2ï¸âƒ£ RETRY (2 intentos)               â”‚
           â”‚  .retryWhen(Retry.backoff(2, 50ms)) â”‚
           â”‚                                       â”‚
           â”‚  ğŸ”„ Solo para errores transitorios:  â”‚
           â”‚     â€¢ TimeoutException                â”‚
           â”‚     â€¢ IOException                     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  3ï¸âƒ£ CIRCUIT BREAKER                  â”‚
           â”‚  .transformDeferred(                 â”‚
           â”‚      CircuitBreakerOperator.of(cb)   â”‚
           â”‚  )                                    â”‚
           â”‚                                       â”‚
           â”‚  Estados:                             â”‚
           â”‚  ğŸŸ¢ CLOSED   â†’ Normal                â”‚
           â”‚  ğŸŸ¡ OPEN     â†’ Bloqueado             â”‚
           â”‚  ğŸŸ  HALF_OPEN â†’ Probando             â”‚
           â”‚                                       â”‚
           â”‚  ConfiguraciÃ³n (application.yml):    â”‚
           â”‚  â€¢ failureRateThreshold: 50%         â”‚
           â”‚  â€¢ waitDurationInOpenState: 10s      â”‚
           â”‚  â€¢ slidingWindowSize: 10             â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  4ï¸âƒ£ FALLBACK                         â”‚
           â”‚  .onErrorResume(ex â†’                 â”‚
           â”‚      fallbackSeguro(cuenta)          â”‚
           â”‚  )                                    â”‚
           â”‚                                       â”‚
           â”‚  ğŸ†˜ Devuelve:                        â”‚
           â”‚     new Saldo(cuenta, 0.0)           â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   âœ… Respuesta     â”‚
                    â”‚   (exitosa o       â”‚
                    â”‚    fallback)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Estados del Circuit Breaker

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ğŸŸ¢ CLOSED      â”‚
                    â”‚  (Normal)       â”‚
                    â”‚                 â”‚
                    â”‚  Peticiones     â”‚
                    â”‚  pasan          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Falla > 50%
                            â”‚ (threshold)
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ğŸŸ¡ OPEN        â”‚
                    â”‚  (Bloqueado)    â”‚
                    â”‚                 â”‚
                    â”‚  Peticiones     â”‚
                    â”‚  rechazadas     â”‚
                    â”‚  (fail-fast)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Espera 10s
                            â”‚ (waitDuration)
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ğŸŸ  HALF_OPEN   â”‚
                    â”‚  (Probando)     â”‚
                    â”‚                 â”‚
                    â”‚  Permite        â”‚
                    â”‚  algunas        â”‚
                    â”‚  peticiones     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚           â”‚
          âœ… Ã‰xito    â”‚           â”‚  âŒ Fallo
          (majority)   â”‚           â”‚
                       â–¼           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  ğŸŸ¢ CLOSED  â”‚  â”‚  ğŸŸ¡ OPEN    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ ConversiÃ³n de Entidades (Entity â†” Domain)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               CAPA DE INFRAESTRUCTURA                          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚  â”‚      SaldoEntity         â”‚   Representa tabla en BD        â”‚
â”‚  â”‚  (Persistence Entity)    â”‚                                 â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                 â”‚
â”‚  â”‚  @Id                     â”‚                                 â”‚
â”‚  â”‚  private Long id         â”‚   âš ï¸ Anotaciones JPA/R2DBC     â”‚
â”‚  â”‚  @Table("saldos")        â”‚   âš ï¸ Mutable                   â”‚
â”‚  â”‚  private String cuenta   â”‚   âš ï¸ Depende de framework      â”‚
â”‚  â”‚  private Double monto    â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚               â”‚        â–²                                        â”‚
â”‚               â”‚        â”‚                                        â”‚
â”‚    toDomain() â”‚        â”‚ fromDomain()                          â”‚
â”‚               â”‚        â”‚                                        â”‚
â”‚               â–¼        â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚        â”‚
                â”‚        â”‚
                â–¼        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               CAPA DE DOMINIO                                   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚  â”‚        Saldo             â”‚   Concepto de negocio           â”‚
â”‚  â”‚    (Domain Model)        â”‚                                 â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                 â”‚
â”‚  â”‚  private final String    â”‚   âœ… Sin anotaciones            â”‚
â”‚  â”‚          numeroCuenta    â”‚   âœ… Inmutable (final)          â”‚
â”‚  â”‚  private final double    â”‚   âœ… Independiente              â”‚
â”‚  â”‚          monto           â”‚   âœ… LÃ³gica de negocio          â”‚
â”‚  â”‚                          â”‚                                 â”‚
â”‚  â”‚  + tieneFondos()         â”‚   MÃ©todos de dominio            â”‚
â”‚  â”‚  + aplicarDescuento()    â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EJEMPLO DE CONVERSIÃ“N:

// Entity â†’ Domain (en SaldoRepositoryAdapter)
SaldoEntity entity = repository.findByNumeroCuenta("123");
Saldo dominio = entity.toDomain();

// Domain â†’ Entity (para guardar en BD)
Saldo dominio = new Saldo("123", 5000.0);
SaldoEntity entity = SaldoEntity.fromDomain(dominio);
repository.save(entity);
```

---

## ğŸ§© InyecciÃ³n de Dependencias (Dependency Injection)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Spring IoC Container                          â”‚
â”‚                                                                  â”‚
â”‚  Registra todos los @Component, @Service, @Repository          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â”‚ Crea instancias y resuelve dependencias
   â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                                               â”‚
   â–¼                                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  @Component                  â”‚          â”‚  @Component                  â”‚
â”‚  RedisCacheAdapter           â”‚          â”‚  SaldoRepositoryAdapter      â”‚
â”‚  implements SaldoCachePort   â”‚          â”‚  implements                  â”‚
â”‚                              â”‚          â”‚      SaldoRepositoryPort     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Inyecta en constructor
                           â”‚
                           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  @Service                          â”‚
            â”‚  ConsultarSaldoUseCaseImpl         â”‚
            â”‚  implements ConsultarSaldoUseCase  â”‚
            â”‚                                    â”‚
            â”‚  constructor(                      â”‚
            â”‚    SaldoRepositoryPort repo,  â—„â”€â”€â”€â”€â”¼â”€â”€ Puerto (interfaz)
            â”‚    SaldoCachePort cache       â—„â”€â”€â”€â”€â”¼â”€â”€ Puerto (interfaz)
            â”‚  )                                 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Inyecta en constructor
                           â”‚
                           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  @RestController                   â”‚
            â”‚  SaldoController                   â”‚
            â”‚                                    â”‚
            â”‚  constructor(                      â”‚
            â”‚    ConsultarSaldoUseCase useCase â—„â”€â”¼â”€â”€ Puerto IN (interfaz)
            â”‚  )                                 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Ventaja: El controller NO conoce las implementaciones concretas
âœ… FÃ¡cil cambiar RedisCacheAdapter por HazelcastCacheAdapter
âœ… Testing fÃ¡cil con mocks
```

---

## ğŸ“¦ Empaquetado por Feature (Package by Feature)

```
HEXAGONAL/
â”‚
â”œâ”€â”€ domain/                    # ğŸŸ¦ DOMINIO
â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â””â”€â”€ Saldo.java         â† Modelo inmutable
â”‚   â”œâ”€â”€ exception/
â”‚   â”‚   â””â”€â”€ SaldoNoEncontradoException.java
â”‚   â””â”€â”€ port/
â”‚       â”œâ”€â”€ in/                â† QuÃ© hace la app
â”‚       â”‚   â””â”€â”€ ConsultarSaldoUseCase.java
â”‚       â””â”€â”€ out/               â† QuÃ© necesita la app
â”‚           â”œâ”€â”€ SaldoRepositoryPort.java
â”‚           â””â”€â”€ SaldoCachePort.java
â”‚
â”œâ”€â”€ application/               # ğŸŸ¨ APLICACIÃ“N
â”‚   â””â”€â”€ usecase/
â”‚       â””â”€â”€ ConsultarSaldoUseCaseImpl.java  â† OrquestaciÃ³n
â”‚
â””â”€â”€ infrastructure/            # ğŸŸ© INFRAESTRUCTURA
    â”œâ”€â”€ adapter/
    â”‚   â”œâ”€â”€ in/
    â”‚   â”‚   â””â”€â”€ rest/
    â”‚   â”‚       â”œâ”€â”€ SaldoController.java
    â”‚   â”‚       â””â”€â”€ GlobalExceptionHandler.java
    â”‚   â””â”€â”€ out/
    â”‚       â”œâ”€â”€ persistence/
    â”‚       â”‚   â”œâ”€â”€ SaldoEntity.java
    â”‚       â”‚   â”œâ”€â”€ SaldoR2dbcRepository.java
    â”‚       â”‚   â””â”€â”€ SaldoRepositoryAdapter.java
    â”‚       â””â”€â”€ cache/
    â”‚           â””â”€â”€ RedisCacheAdapter.java
    â””â”€â”€ config/
        â””â”€â”€ RedisConfig.java
```

---

**ğŸ“ Tip de aprendizaje**: Imprime estos diagramas y tenlos a mano mientras exploras el cÃ³digo.
